{% extends "base_generic.html" %}

{% block content %}
    <div class="card">
        <div><a  class="button" href="{%url 'mappost_new' %}">Create a new Map Post</a></div>
        <div id="map" style="width:100%;height:90%;margin-top:1%;margin-bottom:1%"></div>
    </div>
    
    <script>
        var map;
        //var icon;
        function myMap() {
            var mapOptions = {
                center: new google.maps.LatLng(42.389440, -72.526371),
                zoom: 15,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            }
            
            map = new google.maps.Map(document.getElementById("map"), mapOptions);
            icon = {
                url: "https://image.flaticon.com/icons/svg/60/60995.svg", // url
                scaledSize: new google.maps.Size(33, 33), // scaled size
                origin: new google.maps.Point(0,0), // origin
                anchor: new google.maps.Point(0, 0) // anchor
            };

            {% for post in mappost_list %}
                var loc = new google.maps.LatLng({{post.latitude}}, {{post.longitude}});
                var marker1 = new google.maps.Marker({
                    position: loc,
                    icon: icon,
                    map: map,
                    title: 'title'
                });
    
            addInfoWindow(marker1,
            
            
                        "<img src=\"http://127.0.0.1:8000/pawpular/{{post.image}}\" width = 450px alt='1'>\
                        <h3>{{post.title}} - <a style=\"color:purple;\">{{post.createdBy.fname}} {{post.createdBy.lname}}</a></h3>\
                        <p>{{post.text}}</p>"
                                
                                
                                
                        );
            {% endfor %}

            google.maps.event.addListener(map, 'click', function(event) {
                 placeMarker(event.latLng);
             });
                
             setMarkers(map);
        }
            
        function addInfoWindow(marker, content){
            var infoWindow = new google.maps.InfoWindow({
                content: content
            });
                
            google.maps.event.addListener(marker, 'click', function () {
                infoWindow.open(map, marker);
            });
        }
            
        function placeMarker(location) {
            if(confirm("Confirm Marker?")) {
                window.location = "{%url 'mappost_new' %}";
                var marker = new google.maps.Marker({
                    position: location,
                    map: map,
                    icon:icon
                });
            }
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?callback=myMap"></script>

{% endblock %}


<!---

-->

